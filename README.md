# 气体传感器数据分析平台 (Gas Sensor Data Analysis Platform)

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![Dash](https://img.shields.io/badge/Dash-2.14%2B-orange.svg)](https://dash.plotly.com/)
[![Plotly](https://img.shields.io/badge/Plotly-5.18%2B-purple.svg)](https://plotly.com/)
[![Pandas](https://img.shields.io/badge/Pandas-2.0%2B-green.svg)](https://pandas.pydata.org/)

一个基于 Python Dash 和 Plotly 构建的交互式 Web 应用，旨在为科研人员和工程师提供一个无需编程即可快速分析气体传感器数据的强大工具。用户可以上传原始数据，进行可视化、预处理、基线校准、交互式标记，并自动计算关键性能指标。

## 目录

- [主要功能](#主要功能)
- [界面概览](#界面概览)
- [安装与运行](#安装与运行)
  - [方式一：开发者模式 (从源码运行)](#方式一开发者模式-从源码运行)
  - [方式二：最终用户 (使用打包好的可执行文件)](#方式二最终用户-使用打包好的可执行文件)
- [使用流程](#使用流程)
  - [1. 上传文件](#1-上传文件)
  - [2. 数据预处理](#2-数据预处理)
  - [3. (可选) 基线校准](#3-可选-基线校准)
  - [4. 选择分析模式](#4-选择分析模式)
  - [5. 标记关键点](#5-标记关键点)
  - [6. 计算与查看结果](#6-计算与查看结果)
  - [7. 导出数据与结果](#7-导出数据与结果)
- [功能详解](#功能详解)
  - [基线校准模块](#基线校准模块)
  - [指标计算逻辑](#指标计算逻辑)
- [技术栈](#技术栈)
- [贡献](#贡献)
- [许可证](#许可证)

## 主要功能

*   **文件兼容性**: 支持上传 `.csv`, `.xls`, `.xlsx` 格式的传感器数据文件。
*     注意（重要）：输入的文件第一行为表头，第二行及以后为数据；不要包含时间列和时间戳
*   **交互式可视化**: 使用 Plotly 生成高质量、可缩放、可平移的交互式图表。
*   **数据预处理**:
    *   按行号自由截取有效数据段。
    *   设置采样频率，确保时间相关指标（如响应/恢复时间）计算的准确性。
*   **高级基线校准**:
    *   **多种校准算法**: 提供 **比值法 (R/R₀)**、**差值法 (R-R₀)** 和 **反比值法 (1-R/R₀)**。
    *   **固定范围校准**: 使用数据中某段稳定区域的平均值作为全局基线 (R₀)。
    *   **线性拟合校准**: 通过在图上点选多个基线点，自动进行线性拟合，生成动态变化的基线，有效校正传感器漂移。
*   **双重分析模式**:
    *   **单传感器分析**: 聚焦于单个数据列，进行精细化标记和分析。
    *   **多传感器分析**: 同时在图上显示所有传感器曲线，通过垂直线标记对所有传感器进行同步分析，便于横向比较。
*   **一键式指标计算**:
    *   在图上交互式标记**峰值 (Peak)**、**进气点 (Intake)** 和 **出气点 (Exhaust)**。
    *   自动计算并表格化展示关键性能指标：**响应值 (Response Size)**, **Rgas/Rair**, **Rair/Rgas**, **响应时间 (t90)**, **恢复时间 (RT90)**。
*   **数据导出**:
    *   可随时下载经过预处理和校准后的数据 (CSV)。
    *   可将计算出的性能指标表格下载为 CSV 文件，方便后续报告和分析。
*   **用户友好操作**: 提供“撤销上一步”、“清除标记”等功能，提升操作容错率。

## 界面概览

应用界面分为左右两个主要区域：

*   **左侧控制面板**: 包含所有操作和设置选项，从文件上传、数据预处理到分析模式选择和基线校准。
*   **右侧图表与结果区**:
    *   上方是**数据可视化区域**，您可以在此与图表交互。
    *   图表下方是**标记控制按钮**，用于激活不同的标记模式。
    *   最下方是**结果展示区域**，用于显示计算出的指标表格。

![image](https://user-images.githubusercontent.com/your-username/your-repo/assets/screenshot.png)  
*(请在此处替换为您应用的实际截图)*

## 安装与运行

您可以根据自己的需求选择以下任意一种方式来运行本应用。

### 方式一：开发者模式 (从源码运行)

此方式适合希望查看或修改源代码的开发者。

1.  **克隆仓库**
    ```bash
    git clone https://github.com/your-username/your-repository-name.git
    cd your-repository-name
    ```

2.  **创建虚拟环境 (推荐)**
    ```bash
    python -m venv venv
    # Windows
    venv\Scripts\activate
    # macOS / Linux
    source venv/bin/activate
    ```

3.  **安装依赖**
    项目依赖库已在代码中明确。您需要手动安装它们：
    ```bash
    pip install dash pandas plotly openpyxl
    ```
    *注意: `openpyxl` 是 `pandas` 读取 Excel 文件所需要的库。*

4.  **运行应用**
    ```bash
    python app.py
    ```

5.  **访问应用**
    运行后，终端会显示一个本地服务器地址 (通常是 `http://127.0.0.1:8040`)。应用会自动在您的默认浏览器中打开此地址。

### 方式二：最终用户 (使用打包好的可执行文件)

如果您的仓库的 "Releases" 页面提供了打包好的 `.exe` 文件，最终用户可以按以下步骤操作。

1.  从项目的 [GitHub Releases](https://github.com/your-username/your-repository-name/releases) 页面下载最新的可执行文件 (例如 `GasSensorAnalysis.exe`)。
2.  将该文件放置在您希望的任何位置。
3.  双击运行 `.exe` 文件。程序启动时可能会短暂出现一个命令行窗口。
4.  程序会自动在您的默认浏览器中打开应用界面。无需任何安装或配置。

## 使用流程

### 1. 上传文件

点击或将您的数据文件 (`.csv`, `.xls`, `.xlsx`) 拖拽到左上角的上传区域。上传成功后，文件名会显示，并且图表将自动加载数据。

### 2. 数据预处理

*   **截取数据**: 如果您只想分析文件中的一部分数据，请在“截取数据范围”输入框中填入起始和结束的**行号**，然后点击“截取数据”按钮。
*   **设置采样频率**: 在“采样频率 (Hz)”输入框中填入您设备的采样频率。**这是准确计算响应/恢复时间的关键**。例如，如果每秒采样2次，则频率为 2 Hz。

### 3. (可选) 基线校准

如果您的数据存在基线不为零或基线漂移问题，强烈建议使用此功能。

1.  切换到左侧控制面板中的 **“基线校准”** 选项卡。
2.  **选择校准算法**:
    *   `比值法 (R / R0)`: 适用于响应表现为电阻值成倍变化的传感器。
    *   `差值法 (R - R0)`: 适用于响应表现为电阻值线性增减的传感器。
    *   `反比值法 (1 - R/R0)`: 比值法的变种，适用于某些特定场景。
3.  **选择校准方式**:
    *   **方式一：固定范围平均**:
        *   在图上找到一段稳定的基线区域，记下其对应的**行号**范围。
        *   将此范围填入“Start”和“End”输入框。
        *   点击 **“应用固定”**。图表会自动更新为校准后的数据。
    *   **方式二：多点线性拟合 (推荐用于漂移校准)**:
        *   点击 **“1. 点击选择基线点”** 按钮。
        *   此时，在图表上点击您认为是基线的点（至少2个），图上会出现紫色虚线标记。这些点应能代表基线的漂移趋势。
        *   选择完毕后，点击 **“2. 拟合并应用”**。程序将基于您选择的点进行线性拟合，并用此动态基线校准整个数据集。
4.  若要撤销校准，点击 **“重置原始数据”**。若要重新选择拟合点，点击 **“清除点”**。

### 4. 选择分析模式

在 **“分析设置”** 选项卡中：

*   **单传感器分析**: 选中此模式后，您需要从下方的下拉菜单中选择一个要分析的数据列（传感器）。所有标记和计算将仅针对此列进行。
*   **多传感器分析**: 选中此模式后，图表会同时显示所有数值列。此时进行的标记（峰值、进气、出气）将是贯穿所有曲线的垂直线，用于同步比较。

### 5. 标记关键点

在图表下方的标记控制栏中：

1.  点击您想标记的类型，例如 **“标记峰值”**。
2.  将鼠标移动到图表上，光标会变为十字形。
3.  在曲线的相应位置点击。一个标记点（或线）会出现在图上。
4.  重复此过程以标记所有需要的点。例如，一个完整的响应-恢复过程至少需要一个“进气点”和一个“峰值点”。
5.  标记完成后，可以点击 **“结束标记”** 来禁用点击功能，防止误操作。
6.  如果标记错误，可点击 **“撤销上一步”** 或 **“清除标记”**。

### 6. 计算与查看结果

1.  确保您已至少标记了一个有效的“进气-峰值”对。
2.  点击 **“计算指标”** 按钮。
3.  计算结果将以表格形式出现在下方的结果区域。
4.  同时，图表上也会出现相应的指标标注（如响应时间等）。您可以在“分析设置”中调整标注的字体大小。

### 7. 导出数据与结果

*   **下载当前数据**: 在“分析设置”中，点击此按钮可将右侧图表中显示的（可能已经过截取和校准的）数据下载为 CSV 文件。
*   **下载结果**: 在结果表格的右上角，点击“下载结果 (CSV)”按钮，可将计算出的指标表格保存为 CSV 文件。

## 功能详解

### 基线校准模块

基线校准的目的是消除背景信号和传感器漂移对测量结果的影响，确保计算出的响应值等指标的准确性。

*   **R₀ (Baseline Value)**: 指的是传感器在未接触目标气体时（通常是暴露在空气中）的稳定电阻值。
*   **固定范围法**: 适用于整个测试过程中基线非常稳定的情况。它简单快捷，但无法处理漂移。
*   **线性拟合法**: 专为解决**基线漂移**问题而设计。传感器在长时间工作中，其基线值可能会缓慢升高或降低，形成一条倾斜的直线。通过点选多个基线点并拟合，我们可以得到一个动态的 R₀(t) 函数，从而在每个时间点都使用准确的基线值进行计算，大大提高了分析的准确性。

### 指标计算逻辑

本应用根据行业标准计算以下核心指标：

*   **响应值 (Response Size, S)**: 定义为 \( S = (R_{gas} - R_{air}) / R_{air} \)，其中 \( R_{gas} \) 是接触目标气体后的稳定响应值（峰值），\( R_{air} \) 是基线值（进气点）。它表示了响应的相对大小。
*   **Rgas/Rair** 或 **Rair/Rgas**: 响应的另一种表示形式，即响应值与基线值的比率。
*   **响应时间 (t90)**: 从“进气点”开始，到响应值达到峰值响应幅度（\( R_{gas} - R_{air} \)）的90%时所花费的时间。
*   **恢复时间 (RT90)**: 从“出气点”（气体被移除的时刻）开始，到响应值恢复到距离基线只有峰值响应幅度10%时所花费的时间。

## 技术栈

*   **后端与Web框架**: [Dash](https://dash.plotly.com/)
*   **数据处理**: [Pandas](https://pandas.pydata.org/), [NumPy](https://numpy.org/)
*   **交互式图表**: [Plotly](https://plotly.com/)
*   **打包**: 代码结构兼容 [PyInstaller](https://pyinstaller.org/)

## 贡献

欢迎任何形式的贡献！如果您发现了 Bug 或有任何功能建议，请随时提交 [Issues](https://github.com/your-username/your-repository-name/issues)。如果您希望贡献代码，请 Fork 本仓库并提交 Pull Request。

## 许可证

该项目采用 [MIT 许可证](LICENSE)。# findResponse
